function e(e){const t=`${e}=`,o=decodeURIComponent(document.cookie).split(";");for(let e=0;e<o.length;e++){let s=o[e];for(;" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}const t={order:["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18n_dom",lookupLocalStorage:"i18nDOMLng",lookupSessionStorage:"i18nDOMLng",caches:["localStorage"]};function o(e,t){const{caches:o,lookupQuerystring:s,lookupCookie:a,lookupLocalStorage:n,lookupSessionStorage:r}=t;o.forEach((t=>{"localStorage"===t?localStorage[n]=e:"sessionStorage"===t?sessionStorage[r]=e:"cookie"===t?function(e,t,o=30){const s=new Date;s.setTime(s.getTime()+24*o*60*60*1e3),document.cookie=`${e}=${t}; expires=${s.toUTCString()}`}(a,e):"querystring"===t&&function(e,t){const o=new URLSearchParams(window.location.search);o.set(e,t),window.location.search=o.toString()}(s,e)}))}const s={childList:!0,subtree:!0},a={subtree:!0,characterData:!0};class n{constructor({attachNode:o,htmlLanguage:s,resource:a,language:n,fallbackLng:r,detection:i}){this.attachNode=o||document.body,this.htmlLanguage=s||document.documentElement.lang||"en",this.resource=a,this.fallbackLng=r,this.detectOptions=Object.assign({},t,i),this.setLanguage(n||function(t){const{order:o,lookupQuerystring:s,lookupCookie:a,lookupLocalStorage:n,lookupSessionStorage:r}=t;let i="";for(let t=0;t<o.length;t++){const l=o[t];if("querystring"===l?(c=s,i=new URLSearchParams(window.location.search).get(c)):"cookie"===l?i=e(a):"localStorage"===l?i=localStorage[n]:"sessionStorage"===l?i=sessionStorage[r]:"navigator"===l?i=navigator.language:"htmlTag"===l&&(i=document.documentElement.lang),i)break}var c;return i}(this.detectOptions),!1),this.textObserver=new MutationObserver((e=>{this.stopTextObserve(),e.forEach((e=>{this.translateTextNode(e.target,this.htmlLanguage)})),this.startTextObserve()})),this.nodeObserver=new MutationObserver((e=>{this.stopTextObserve(),e.forEach((e=>{e.addedNodes.forEach((e=>{3===e.nodeType?this.translateTextNode(e,this.htmlLanguage):this.translateNodeTree(e,this.htmlLanguage)}))})),this.startTextObserve()})),this.startNodeObserve(),this.startNodeObserve()}startTextObserve(){this.textObserver.observe(this.attachNode,a)}stopTextObserve(){this.textObserver.disconnect()}startNodeObserve(){this.nodeObserver.observe(this.attachNode,s)}stopNodeObserve(){this.nodeObserver.disconnect()}startObserve(){this.startTextObserve(),this.startNodeObserve()}stopObserve(){this.stopTextObserve(),this.stopNodeObserve()}setLanguage(e,t=!0){const s=Object.keys(this.resource);let a=this.fallbackLng||s[0];-1!==s.indexOf(e)&&(a=e),this.language=a,t&&o(a,this.detectOptions)}changeLanguage(e){if(this.language!==e){const t=this.language;this.setLanguage(e),this.stopObserve(),this.translateNodeTree(this.attachNode,t),this.startObserve()}}getMacroContent(e){var t,o,s;const a=[...e.matchAll(/\sI18NDOM_(\S+)\s((.(?!I18NDOM_))+)/g)],n=e.match(" I18NDOM_IGNORE"),r=!!n,i=!!a.length||r;let c=null===(t=a[0])||void 0===t?void 0:t.index;r&&(c=(null===(o=a[0])||void 0===o?void 0:o.index)>n.index?n.index:null===(s=a[0])||void 0===s?void 0:s.index);let l=[],h="";return i&&a.forEach((e=>{let t=e[1];if("DATA"===t){const t=[...e[2].matchAll(/(\S+)=(.*)/g)][0];l.push({key:t[1],value:t[2]})}else"KEY"===t&&(h+=e[0])})),{hasMacro:i,isIgnore:r,startIndex:c,matchedData:l,matchedKey:h}}clearMacroInfo(e){const t=e.indexOf(" I18NDOM_");return-1!==t?e.substring(0,t):e}translateNodeTree(e,t){(function(e){let t;const o=[],s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);for(;t=s.nextNode();)o.push(t);return o})(e).forEach((e=>{this.translateTextNode(e,t)}))}translateTextNode(e,t){const o=e.data,s=e.nextSibling,a=8===(null==s?void 0:s.nodeType)&&s.data.includes("I18NDOM_");let n=o,r=null,i=[],c=!1;const{hasMacro:l,matchedData:h,matchedKey:g,startIndex:d,isIgnore:u}=this.getMacroContent(o);if(l)c=u,i=h,r=document.createComment(o.substring(d)),n=`${o.substring(0,d)}${g}`;else if(a){const{matchedKey:e,matchedData:t,isIgnore:o}=this.getMacroContent(s.data);c=o,i=t,t.length&&t.forEach((e=>{const{key:t,value:o}=e;n=n.replaceAll(o,`%${t}%`)})),n=`${n}${e}`}let O=n;if(c)O=this.clearMacroInfo(O);else{const e=this.resource[t].indexOf(n);-1!==e&&(O=this.clearMacroInfo(this.resource[this.language][e])),i.length&&i.forEach((e=>{const{key:t,value:o}=e;O=O.replaceAll(`%${t}%`,o)}))}e.data=O,r&&(a?s.replaceWith(r):e.after(r))}}export{n as default};
