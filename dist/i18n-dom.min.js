var I18nDOM=function(){"use strict";const e={childList:!0,subtree:!0},t={subtree:!0,characterData:!0};return class{constructor({attachNode:e,htmlLanguage:t,resource:s,language:a}){this.attachNode=e||document.body,this.htmlLanguage=t||document.documentElement.lang||"en",this.language=a||this.htmlLanguage,this.resource=s,this.textObserver=new MutationObserver((e=>{this.stopTextObserve(),e.forEach((e=>{this.translateTextNode(e.target,this.htmlLanguage)})),this.startTextObserve()})),this.nodeObserver=new MutationObserver((e=>{this.stopTextObserve(),e.forEach((e=>{e.addedNodes.forEach((e=>{3===e.nodeType?this.translateTextNode(e,this.htmlLanguage):this.translateNodeTree(e,this.htmlLanguage)}))})),this.startTextObserve()})),this.startNodeObserve(),this.startNodeObserve()}startTextObserve(){this.textObserver.observe(this.attachNode,t)}stopTextObserve(){this.textObserver.disconnect()}startNodeObserve(){this.nodeObserver.observe(this.attachNode,e)}stopNodeObserve(){this.nodeObserver.disconnect()}startObserve(){this.startTextObserve(),this.startNodeObserve()}stopObserve(){this.stopTextObserve(),this.stopNodeObserve()}changeLanguage(e){if(this.language!==e){const t=this.language;this.language=e,this.stopObserve(),this.translateNodeTree(this.attachNode,t),this.startObserve()}}getMacroContent(e){const t=[...e.matchAll(/\sI18NDOM_(\S+)\s((.(?!I18NDOM_))+)/g)],s=e.match(" I18NDOM_IGNORE"),a=!!s,r=!!t.length||a;let n=t[0]?.index;a&&(n=t[0]?.index>s.index?s.index:t[0]?.index);let o=[],h="";return r&&t.forEach((e=>{let t=e[1];if("DATA"===t){const t=[...e[2].matchAll(/(\S+)=(.*)/g)][0];o.push({key:t[1],value:t[2]})}else"KEY"===t&&(h+=e[0])})),{hasMacro:r,isIgnore:a,startIndex:n,matchedData:o,matchedKey:h}}clearMacroInfo(e){const t=e.indexOf(" I18NDOM_");return-1!==t?e.substring(0,t):e}translateNodeTree(e,t){(function(e){let t;const s=[],a=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);for(;t=a.nextNode();)s.push(t);return s})(e).forEach((e=>{this.translateTextNode(e,t)}))}translateTextNode(e,t){const s=e.data,a=e.nextSibling,r=8===a?.nodeType&&a.data.includes("I18NDOM_");let n=s,o=null,h=[],i=!1;const{hasMacro:c,matchedData:l,matchedKey:d,startIndex:u,isIgnore:g}=this.getMacroContent(s);if(c)i=g,h=l,o=document.createComment(s.substring(u)),n=`${s.substring(0,u)}${d}`;else if(r){const{matchedKey:e,matchedData:t,isIgnore:s}=this.getMacroContent(a.data);i=s,h=t,t.length&&t.forEach((e=>{const{key:t,value:s}=e;n=n.replaceAll(s,`%${t}%`)})),n=`${n}${e}`}let O=n;if(i)O=this.clearMacroInfo(O);else{const e=this.resource[t].indexOf(n);-1!==e&&(O=this.clearMacroInfo(this.resource[this.language][e])),h.length&&h.forEach((e=>{const{key:t,value:s}=e;O=O.replaceAll(`%${t}%`,s)}))}e.data=O,o&&(r?a.replaceWith(o):e.after(o))}}}();
