var I18nDOM=function(){"use strict";const e={order:["localStorage","navigator","htmlTag"],lookupLocalStorage:"i18nDOMLng",caches:["localStorage"]};const t={childList:!0,subtree:!0},a={subtree:!0,characterData:!0};return class{constructor({attachNode:t,htmlLanguage:a,resource:s,language:r,fallbackLng:o,detection:n}){this.attachNode=t||document.body,this.htmlLanguage=a||document.documentElement.lang||"en",this.resource=s,this.fallbackLng=o,this.detectOptions=Object.assign({},e,n),this.setLanguage(r||function(e){const{order:t,lookupLocalStorage:a}=e;let s="";for(let e=0;e<t.length&&("localStorage"===t[e]?s=localStorage[a]:"navigator"===t[e]?s=navigator.language:"htmlTag"===t[e]&&(s=document.documentElement.lang),!s);e++);return s}(this.detectOptions)),this.textObserver=new MutationObserver((e=>{this.stopTextObserve(),e.forEach((e=>{this.translateTextNode(e.target,this.htmlLanguage)})),this.startTextObserve()})),this.nodeObserver=new MutationObserver((e=>{this.stopTextObserve(),e.forEach((e=>{e.addedNodes.forEach((e=>{3===e.nodeType?this.translateTextNode(e,this.htmlLanguage):this.translateNodeTree(e,this.htmlLanguage)}))})),this.startTextObserve()})),this.startNodeObserve(),this.startNodeObserve()}startTextObserve(){this.textObserver.observe(this.attachNode,a)}stopTextObserve(){this.textObserver.disconnect()}startNodeObserve(){this.nodeObserver.observe(this.attachNode,t)}stopNodeObserve(){this.nodeObserver.disconnect()}startObserve(){this.startTextObserve(),this.startNodeObserve()}stopObserve(){this.stopTextObserve(),this.stopNodeObserve()}setLanguage(e){const t=Object.keys(this.resource);let a=this.fallbackLng||t[0];-1!==t.indexOf(e)&&(a=e),this.language=a;const{caches:s,lookupLocalStorage:r}=this.detectOptions;s.forEach((e=>{"localStorage"===e&&(localStorage[r]=a)}))}changeLanguage(e){if(this.language!==e){const t=this.language;this.setLanguage(e),this.stopObserve(),this.translateNodeTree(this.attachNode,t),this.startObserve()}}getMacroContent(e){const t=[...e.matchAll(/\sI18NDOM_(\S+)\s((.(?!I18NDOM_))+)/g)],a=e.match(" I18NDOM_IGNORE"),s=!!a,r=!!t.length||s;let o=t[0]?.index;s&&(o=t[0]?.index>a.index?a.index:t[0]?.index);let n=[],c="";return r&&t.forEach((e=>{let t=e[1];if("DATA"===t){const t=[...e[2].matchAll(/(\S+)=(.*)/g)][0];n.push({key:t[1],value:t[2]})}else"KEY"===t&&(c+=e[0])})),{hasMacro:r,isIgnore:s,startIndex:o,matchedData:n,matchedKey:c}}clearMacroInfo(e){const t=e.indexOf(" I18NDOM_");return-1!==t?e.substring(0,t):e}translateNodeTree(e,t){(function(e){let t;const a=[],s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);for(;t=s.nextNode();)a.push(t);return a})(e).forEach((e=>{this.translateTextNode(e,t)}))}translateTextNode(e,t){const a=e.data,s=e.nextSibling,r=8===s?.nodeType&&s.data.includes("I18NDOM_");let o=a,n=null,c=[],h=!1;const{hasMacro:i,matchedData:l,matchedKey:g,startIndex:d,isIgnore:u}=this.getMacroContent(a);if(i)h=u,c=l,n=document.createComment(a.substring(d)),o=`${a.substring(0,d)}${g}`;else if(r){const{matchedKey:e,matchedData:t,isIgnore:a}=this.getMacroContent(s.data);h=a,c=t,t.length&&t.forEach((e=>{const{key:t,value:a}=e;o=o.replaceAll(a,`%${t}%`)})),o=`${o}${e}`}let O=o;if(h)O=this.clearMacroInfo(O);else{const e=this.resource[t].indexOf(o);-1!==e&&(O=this.clearMacroInfo(this.resource[this.language][e])),c.length&&c.forEach((e=>{const{key:t,value:a}=e;O=O.replaceAll(`%${t}%`,a)}))}e.data=O,n&&(r?s.replaceWith(n):e.after(n))}}}();
